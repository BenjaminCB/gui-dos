@page "/products-delete"
@using System.Collections.Generic
@using BlazorApp.Models
@using BlazorApp.Services
@using BlazorApp.Data
@using Microsoft.EntityFrameworkCore;

@inject IDbContextFactory<IsvaerftetDbContext> DbContextFactory
@inject NavigationManager NavMan

<h1>Remove Products</h1>

@if (products == null)
{
    <div>
        Loading...
    </div>
}

@if (products != null && products.Count == 0)
{
    <div>
        No products found...
    </div>
}

@if (products != null)
{
    @foreach (var product in products)
    {
        <div @key="product">
            <button @onclick="() => ProductDelete(product)">
                <img src="@product.Image">
            </button>
        </div>
    }
}

@code
{
    private List<Product> products;

    protected override async Task OnInitializedAsync()
    {
        using (var ctx = DbContextFactory.CreateDbContext())
        {
            products = await ctx.Products.ToListAsync();
        }
    }

    private async Task ProductDelete(Product p)
    {
        using (var ctx = DbContextFactory.CreateDbContext())
        {
            ctx.Products.Remove(p);
            await ctx.SaveChangesAsync();
            products = await ctx.Products.ToListAsync();
        }
    }
}

